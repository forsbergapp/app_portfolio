# DNS records
    
    Update DNS records using Ubuntu server IP address as needed

    use wildcard *.[domain] and *.test.[domain] or register each subdomain admin.[domain], app1.[domain] etc.
    
    Windows
        For localhost DNS settings check browser support and update hosts file on Windows if necessary.
    
        Example C:\Windows\System32\drivers\etc\hosts:
        ::1	admin.localhost
        ::1	app1.localhost
        ::1	app2.localhost
        ::1	app3.localhost
        ::1	app4.localhost
        ::1	app5.localhost
        ::1	app6.localhost

# Install NodeJS

    NodeJs modules

        bcrypt              used by database passwords 
        express             web framework for NodeJs
        jsonwebtoken        implements the use of JSON web tokens
        nodemailer          sends email from NodeJs
        mysql               connects to database MariaDB and MySQL
        oracledb            connects to database Oracle
        pg                  connects to database PostgreSQL
        compression         encodes content using gzip for performance, not used by EventSource
                            check module documentaion about using Cache-Control and compression, 
                            APP_CACHE_CONTROL and APP_CACHE_CONTROL_FONT parameters can be modified
                            to adjust performance
        praytimes           calculates prayer times
        easyqrcodejs-nodejs creates QR codes
        puppeteer           creates PDF

        developer only modules installed in Windows:

        @types/compression  types for compression
        @types/express      types for express
        @types/jasmine      types for jasmine
        @types/jsonwebtoken types for jsonwebtoken
        @types/mysql        types for mysql
        @types/nodemailer   types for nodemailer
        @types/oracledb"    types for oracledb
        @types/pg           types for pg
        eslint              identifies and reports patterns found for javascript including jasmine 
                            and follows latest standards with some basic settings like 
                            the use of single quotes
        jasmine             test framework for NodeJs 
                            (configured for future use, see more in test documentation)
        jsdoc               used for typescript without build step that checks typing 
                            (see more in typescript documentation)
        typescript          used for typescript without build step that configures typescript 
                            (see more in typescript documentation)

    Ubuntu

        --(Check version)
        sudo curl -sL https://deb.nodesource.com/setup_20.x | sudo -E bash -
        sudo apt install nodejs
        sudo setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/node
        
        --needed for easyqrcodejs-nodejs
        sudo apt-get install build-essential libcairo2-dev libpango1.0-dev libjpeg-dev libgif-dev librsvg2-dev

        --install everything except developer modules
        cd $HOME/app_portfolio

        --alt 1 default
        npm install --omit=dev
        
        --alt 2 if puppeteer needs manual configuration
        npm install bcrypt express jsonwebtoken nodemailer mysql oracledb pg compression praytimes easyqrcodejs-nodejs
        
        --alt 2 puppeteer with default chromium browser
        npm install puppeteer

        --alt 2 puppeteer with custom browser
        --set EXECUTABLE_PATH in microservice PDF (/microservice/config/services.json) to set browser
        env PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm install puppeteer

        --process manager
        npm install -g pm2

        Network security

        Azure
                Add inbound rules 
                Choose service HTTP (port 80)

                Add inbound rules 
                Choose service HTTPS (port 443)

        SSL
            Create SSL directory
                cd $HOME/app_portfolio
                mkdir config
                cd config
                mkdir ssl

            Use existing
                Copy files
                Key
                $HOME/app_portfolio/config/ssl/privkey.pem
                Cert
                $HOME/app_portfolio/config/ssl/fullchain.pem

            Install using Letencrypt
                sudo snap install --classic certbot
                sudo ln -s /snap/bin/certbot /usr/bin/certbot
                
                New SSL
                    cd $HOME/app_portfolio
                    mkdir .well-known
                    cd .well-known
                    mkdir acme-challenge

                    --edit or review /config/config.json parameters
                    --disable https, enable https back after successful SSL files created
                    --HTTPS_ENABLE = 0
                    --letsencrypt should be able to access with "strange" user agent or accept-language variables:
                    --AUTHENTICATE_REQUEST_USER_AGENT = 0
                    --AUTHENTICATE_REQUEST_USER_AGENT_EXIST = 0
                    --AUTHENTICATE_REQUEST_ACCEPT_LANGUAGE = 0

                    --replace [domain] with your domain, [email] with your email:

                    sudo certbot certonly --manual --agree-tos --config-dir $HOME/app_portfolio/config/ssl --work-dir $HOME/app_portfolio/config/ssl --logs-dir $HOME/app_portfolio/config/ssl --cert-path $HOME/app_portfolio/config/ssl --key-path $HOME/app_portfolio/config/ssl --fullchain-path $HOME/app_portfolio/config/ssl -m [email] -d *.test.[domain] -d *.[domain] -d [domain]

                    --follow Letsencrypt instructions
                    --Configure test.[domain] in DNS on same server or separate server.

                    --copy SSL files to correct path
                    sudo cp $HOME/app_portfolio/config/ssl/live/test.[domain]/privkey.pem $HOME/app_portfolio/config/ssl/privkey.pem
                    sudo cp $HOME/app_portfolio/config/ssl/live/test.[domain]/fullchain.pem $HOME/app_portfolio/config/ssl/fullchain.pem

                Renew SSL
                    sudo HOME=$HOME certbot renew --manual-auth-hook $HOME/app_portfolio/scripts/SSL_authenticator.sh --manual-cleanup-hook $HOME/app_portfolio/scripts/SSL_cleanup.sh --config-dir $HOME/app_portfolio/config/ssl --work-dir $HOME/app_portfolio/config/ssl --logs-dir $HOME/app_portfolio/config/ssl --cert-path $HOME/app_portfolio/config/ssl --key-path $HOME/app_portfolio/config/ssl --fullchain-path $HOME/app_portfolio/config/ssl

                    --if you get "Certificate not yet due for renewal" add --force-renewal to above statement
                    --copy updated SSL files to correct path
                    sudo cp $HOME/app_portfolio/config/ssl/live/test.[domain]/privkey.pem $HOME/app_portfolio/config/ssl/privkey.pem
                    sudo cp $HOME/app_portfolio/config/ssl/live/test.[domain]/fullchain.pem $HOME/app_portfolio/config/ssl/fullchain.pem

                Check certbot log
                sudo vi /var/log/letsencrypt/letsencrypt.log

    Windows

        --(Check version)
        --Download from https://nodejs.org/
        --https://nodejs.org/dist/v19.3.0/node-v19.3.0-x64.msi

        cd %HOMEPATH%\app_portfolio
        --alt 1 default
        npm install

        --alt 2 if puppeteer needs manual configuration
        npm install bcrypt dotenv express jsonwebtoken nodemailer mysql oracledb pg praytimes easyqrcodejs-nodejs
        npm install -D @types/compression @types/express @types/jasmine @types/jsonwebtoken @types/mysql @types/nodemailer @types/oracledb @types/pg eslint jasmine jsdoc typescript

        --alt 2 puppeteer with default chromium browser
        npm install puppeteer
        
        --alt 2 puppeteer with custom browser
        --set EXECUTABLE_PATH in microservice PDF (/microservice/config/services.json) to set browser
        env PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm install puppeteer

        --process manager
        npm install -g pm2

        SSL
            --Localhost self sign Windows

            mkdir config
            cd config
            mkdir ssl
            cd ssl
            "c:\Program Files\Git\usr\bin\openssl.exe" req -newkey rsa:2048 -keyout privkey.pem -x509 -days 365 -out fullchain.pem -nodes -sha256 -subj '/CN=localhost'


        