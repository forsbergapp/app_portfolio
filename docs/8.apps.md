# Start app or report
    In browser
    apps:
        [SUBDOMAIN].[DOMAIN]
        or
        [SUBDOMAIN].[DOMAIN]/[OPTIONAL_PARAMETER]

    reports:
        [SUBDOMAIN].[DOMAIN]/reports?[PARAMETERS]

    Endpoint routes definitions:
    /server/express/apps.js
        serverExpressApps()

# App registry
    The file /config/apps.json is generated first time from /server/default_apps.json with SHA256 secrets and 
    is the app registry with apps available on NodeJs server.

    APP_ID          : APP id used in database where data is stored for this app id
    SUBDOMAIN       : APP subdomain for the app.
                      Make sure DNS records are correct.
    PATH            : APP Path for public files on disk
    ENDPOINT        : APP Endpoint in public url for public files on disk in PATH parameter
    
    Render parameters:
    ------------------
    LOGO            : APP logo url
    MANIFEST        : APP PWA manifest url
    JS              : APP javascript url
    JS_SECURE       : APP secure javascript url, used when logged in or if separate secure logic is desired
    JS_REPORT       : APP report javascript url if used in app, standalone reports should use javascript only in server and output pure css and html
    CSS             : APP CSS url
    CSS_REPORT      : APP report CSS url
    FAVICON_32x32   : APP favicon small
    FAVICON_192x192 : APP favicon big

    Control parameters:
    ------------------
    SHOWINFO        : APP info page parameter, if info page should be displayed
    SHOWPARAM       : APP parameter in url usage, if user account or other parameter should be used, verified and displayed at start, 
                      if app can't verify parameter then app should display start url without a parameter in url
    Secrets:
    --------
    CLIENT_ID       : APP CLIENT_ID using SHA256 to access microservices
    CLIENT_SECRET   : APP CLIENT_SECRET using SHA256 to access microservices
    DATA_SECRET     : APP secret using SHA256 for data token
    DATA_EXPIRE     : APP expire info for data token
    ACCESS_SECRET   : APP secret using SHA256 for access token 
    ACCESS_EXPIRE   : APP expire info for access token

    API in javascript:
    const {ConfigGetApp} = await import(`file://${process.cwd()}/server/config.service.js`);
    ConfigGetApp(req.headers.host, 'SUBDOMAIN') get app id for requested subdomain derived from host variable
    ConfigGetApp([app_id], 'PATH')              get PATH for requested app id
    ConfigGetApp([app_id], 'ENDPOINT')          get ENDPOINT for requested app id
    ConfigGetApp([app_id], 'LOGO')              get LOGO for requested app id
    ConfigGetApp([app_id], 'MANIFEST')          get PWA manifest for requested app id
    ConfigGetApp([app_id], 'JS')                get JS for requested app id
    ConfigGetApp([app_id], 'JS_SECURE')         get JS_SECURE for requested app id
    ConfigGetApp([app_id], 'JS_REPORT')         get JS_REPORT for requested app id
    ConfigGetApp([app_id], 'CSS')               get CSS for requested app id
    ConfigGetApp([app_id], 'CSS_REPORT')        get CSS_REPORT for requested app id
    ConfigGetApp([app_id], 'FAVICON_32x32')     get FAVICON_32x32 for requested app id
    ConfigGetApp([app_id], 'FAVICON_192x192')   get FAVICON_192x192 for requested app id
    ConfigGetApp([app_id], 'SHOWINFO')          get SHOWINFO for requested app id
    ConfigGetApp([app_id], 'SHOWPARAM')         get SHOWPARAM for requested app id
    ConfigGetApp([app_id], 'CLIENT_ID')         get CLIENT_ID for requested app id
    ConfigGetApp([app_id], 'CLIENT_SECRET')     get CLIENT_SECRET for requested app id
    ConfigGetApp([app_id], 'ACCESS_SECRET')     get ACCESS_SECRET for requested app id
    ConfigGetApp([app_id], 'ACCESS_EXPIRE')     get ACCESS_EXPIRE for requested app id
    ConfigGetApp([app_id], 'DATA_SECRET')       get DATA_SECRET for requested app id
    ConfigGetApp([app_id], 'DATA_EXPIRE')       get DATA_EXPIRE for requested app id
    
    ConfigGetApp(null, 'APPS')                  get all apps with all info above except secrets
                                                
# How to add a new app
    ECMAScript is used in project meaning package.json contains type:module.
    pm2 starts server setting current work directory to app root directory so use process.cwd() when needed.
            
# Required
    /apps/app[APP_ID]/scripts/install_database.json
    /apps/app[APP_ID]/scripts/uninstall_database.json
                                    script links for SQL DDL and DML
                                    review example in provided apps and for each database supported
                                    App should have dedicated database user that will use dedicated database pool
                                    and defined in APP_PARAMETER table
                                    App should have a record in APP table.
                                    More info in database is optional.

                                    example DDL
                                    CREATE USER app[APP_ID] ...
                                    GRANT role_app_common TO app[APP_ID];
                                    
                                    example DML
                                    INSERT INTO app_portfolio.app
                                        (id, enabled, app_category_id) 
                                    VALUES 
                                        ([APP_ID]], 1, [APP_CATEGORY_ID]);

                                    INSERT INTO app_portfolio.app_parameter
                                        (app_id, parameter_type_id, parameter_name, parameter_value, parameter_comment) 
                                    VALUES 
                                        ([APP_ID],'2','SERVICE_DB_APP_USER',[DB_USERNAME],NULL);
                                    
                                    //<APP_PASSWORD/> will be set installing database in admin app
                                    INSERT INTO app_portfolio.app_parameter
                                        (app_id, parameter_type_id, parameter_name, parameter_value, parameter_comment) 
                                    VALUES 
                                        ([APP_ID],'2','SERVICE_DB_APP_PASSWORD',<APP_PASSWORD/>,NULL);
                    

    required files and directories
    /apps/app[APP_ID]*				contains client app files and server code                                

    /apps/app[APP_ID]/src/app.js	review /apps/[OTHER APP NAME]/src/app.js
                                    minimum:
                                    
                                    /**
                                    * Creates app
                                    * @param {number} app_id
                                    * @param {Types.app_parameter} params
                                    * @param {string} locale
                                    * @returns {Promise.<Types.app_create|Types.app_create_empty>}
                                    */
                                    const createApp = (app_id, params, glocale) => {
                                        return new Promise((resolve, reject) => {
                                            const files = [
                                                ['APP', process.cwd() + '/apps/app[APP_ID]]/src/index.html']
                                            ];
                                            import(`file://${process.cwd()}/apps/apps.service.js`).then(({render_app_html}) => {
                                                //set correct parameter what to render or include in app
                                                //set custom tag to place in custom tags in app or use default common UI
                                                render_app_html(app_id, files, {locale:[locale/null], 
                                                                                module_type:'APP', 
                                                                                map: true/false, 
                                                                                custom_tag_profile_search:[app custom tag or null],
                                                                                custom_tag_user_account:[app custom tag or null],
                                                                                custom_tag_profile_top:[app custom tag or null],
                                                                                app_themes:true/false, 
                                                                                render_locales:true/false, 
                                                                                render_settings:true/false, 
                                                                                render_provider_buttons:true/false
                                                                                },(/**@type{Types.error}*/err, /**@type{Types.render_common}*/app)=>{
                                                    if (err)
                                                        reject(err);
                                                    else{
                                                        const render_variables = [];
                                                        //custom app feature in common, set empty if not used
                                                        render_variables.push(['AppProfileInfo','']);
                                                        resolve({   app:render_app_with_data(app.app, render_variables),
                                                                    map_styles: [app.settings.map_styles or null],
                                                                    map:true/false});
                                                    }
                                                })
                                            })
                                        })
                                    }
                                    export{createApp};

    /apps/app[APP_ID]/src/index.html    
                                    minimum:

                                    <!DOCTYPE html>
                                    <html>
                                    <head>
                                        <CommonHead/>
                                    </head>	
                                    <body>
                                        <div id='app'></div>
                                    </body>
                                    </html>

    /apps/app[APP_ID]/js/app.js
                                        const common = await import('common');
                                        const app_exception= () => {
                                            null;
                                        }
                                        const init_app = () => {
                                            null;
                                        }
                                        const init = (parameters) => {
                                            //what app function to execute for common exceptions
                                            common.COMMON_GLOBAL.exception_app_function = app_exception;
                                            common.init_common(parameters).then(()=>{
                                                init_app();
                                            })
                                        }
                                        export{ /*EXCEPTION*/
                                                app_exception,
                                                /*INIT*/
                                                init_app, init}
    REPORTS:
    /apps/app[APP_ID]/src/report/index.js review example in /apps/app2/src/report/index.js
                                        minimum:

                                        /**
                                        * Creates report
                                        * @param {number} app_id
                                        * @param {Types.report_create_parameters} report_parameters
                                        * @returns {Promise.<string>}
                                        */
                                        const createReport = (app_id, report_parameters) => {
                                            const { render_report_html } = await import(`file://${process.cwd()}/apps/apps.service.js`);
                                            const { [REPORT_FUNCTION] } = await import(`file://${process.cwd()}/apps/app[APP_ID]/src/report/[FILENAME].js`);
                                            return new Promise((resolve, reject) => {
                                                const files = [
                                                    ['REPORT', process.cwd() + `/apps/app[APP_ID]/src/report/${report_parameters.reportname}`]
                                                ];
                                                //function that sett head information in html
                                                render_report_html(app_id, files,(/**@type{Types.error}*/err, /**@type{string}*/report)=>{
                                                    if (err)
                                                        reject(err);
                                                    else{
                                                        [REPORT_FUNCTION]({ app_id:         report_parameters.app_id,
                                                                            reportid:       report_parameters.reportid,
                                                                            uid_view:       report_parameters.uid_view, //user account id who is viewing if any
                                                                            ip:             report_parameters.ip,
                                                                            user_agent:     report_parameters.user_agent,
                                                                            accept_language:report_parameters.accept_language,
                                                                            latitude:       report_parameters.latitude,
                                                                            longitude:      report_parameters.longitude,
                                                                            url:            report_parameters.url,      //QR Code url
                                                                            report:         report}).then((/**@type{string}*/report_rendered)=>{
                                                            //should output pure html without any javascript and link to css file
                                                            resolve(report_rendered);
                                                        });
                                                    }
                                                });
                                            });
                                        }
                                        export{createReport};

    /apps/app[APP_ID]/src/report/[REPORT_NAME].html
                                            <!DOCTYPE html>
                                            <html>
                                            <head>
                                                <AppCommonFonts/>
                                                <CommonReportHead/>
                                            </head>	
                                            <body id='printbody' class='<BODY_CLASSNAME/>'>
                                                <div id='report'>
                                                    <div id='paper' class='<REPORT_PAPER_CLASSNAME/>'>
                                                        <[REPORT_TAG]/>
                                                    </div>
                                                </div>
                                            </body>
                                            </html>

    example call reports from app using /apps/app[APP_ID]/public/js/app.js
        const get_report_url = (id, papersize, format) => {
            let server_url = common.getHostname() + `${common.COMMON_GLOBAL.service_report}`;
            let app_parameters = `app_id=${common.COMMON_GLOBAL.app_id}`;
            let report_module = `&module=${app_common.APP_GLOBAL.app_report_timetable}`;
            let module_parameters = `&id=${id}`
            let language_parameter = `&lang_code=${common.COMMON_GLOBAL.user_locale}`;
            let service_parameter = `&format=${format}&ps=${papersize}&hf=0`; //html/pdf, papersize, header/footer
            let encodedurl = common.toBase64(app_parameters +
                                             report_module +
                                             module_parameters + 
                                             language_parameter +
                                             service_parameter);
            //url query parameters are decoded in report module and in report service
            return server_url + '?reportid=' + encodedurl;
        }
        app_common.APP_GLOBAL.app_report_timetable = '[REPORT_NAME]';
        let format = 'HTML'; //or PDF
        let url = get_report_url([id], 'A4', format);
        common.show_window_info(null, false, null, format, url);

# Optional
    client:
    /apps/app[APP_ID]/public                css, images, js etc
    /apps/app[APP_ID]/scripts				database scripts
    /apps/app[APP_ID]/public/sw.js			service worker for PWA apps
    /apps/app[APP_ID]/public/manifest.json	info for PWA apps
    server:
    /apps/app[APP_ID]/src/report			reports
    /apps/app[APP_ID]/src/info				info source pages about disclaimer, privacy_policy, terms
                                            used if ConfigGet(7, [app_id], 'SHOWINFO')==1
                                            see more in /apps/apps.service.js
                                            ex client url: app[APP_ID].[DOMAIN]/info/about

    common client:
    /apps/common/public/audio				audio
    /apps/common/public/css					styles
    /apps/common/public/images				images
    /apps/common/public/js					javascript
    /apps/common/public/modules				referred from /apps/common/src/head_[MODULE].html files
    common server:
    /apps/common/src/						referred from /apps/app[APP_ID]/src/app.js
    /apps/common/src/report/				referred from /apps/app[APP_ID]/src/report/index.js

# How apps are identified
    Apps clients use common.COMMON_GLOBAL.app_id to identify themselves
    Common and admin uses common.COMMON_GLOBAL.common_app_id derived from server parameter APP_COMMON_APP_ID.

#   Restart NodeJS server to automatically load the new app.
    pm2 restart all

    Observe that apps can be enabled and disabled in table app_portfolio.app and 
    updating column enabled to 0 or 1.