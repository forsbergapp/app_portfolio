# Configuration apps

## App REST API 
All apps use frontend to backend function FFB in common.js that calls different role based BFF in server
and follows ISO20022 and ISO23029 standards. The BFF redirects requests to either microsevices or server functions and returns
centralized result from both sources.
URI syntax implemented:
`[protocol]://[domain]/[backend for frontend (bff)]/[role authorization]/version/[resource collection/service]/[resource]/[optional resource id]?URI query`
URI query: `iam=[iam parameters base64 encoded]&ampparameters=[app parameters base64 encoded]`

## App registry
The app tables use ORM pattern and are stored in /data/db/ are generated first time from /server/install/default/ with SHA256 secrets and 
is the app registry with apps available on Node.Js server.
All tables are managed from ORM functions found in `/server/db`

`/data/db/App.json`:
|Key                |Content|
|:------------------|:------|
|Id                 |[id]|
|Name               |[name]|
|Path               |server path for public files|
|Logo               |client logo url|
|Js                 |client path to Javascript, one per app allowed|
|Css                |client path to CSS, one per app allowed|
|CssReport          |client path to optional report css|
|TextEdit           |allow copy/cut/paste and selection of text in browser|
|Copyright          ||
|LinkTitle          ||
|LinkUrl            ||
|Status             |ONLINE/OFFLINE|

`/data/db/AppModule.json`
|Key                |Content|
|:------------------|:------|
|Id                 |[id]|
|ModuleType         |REPORT, MODULE, FUNCTION|
|ModuleName         |[NAME]|
|ModuleRole         |APP_ID, APP_ACCESS, APP_EXTERNAL, ADMIN|
|ModulePath         |server path|
|ModuleDescription  |[description]|
|AppId              |[app id]|

`/data/db/AppModuleQueue.json`
|Key                |Content|
|:------------------|:------|
|Id                 |[id]|
|Type               |REPORT|
|Name               |[NAME]|
|Parameters         |url query parameters used|
|User               |user who submitted|
|Start              |ISO8601 date format|
|End                |ISO8601 date format|
|Progress           |value between 0-1 will be displayed in % in admin app|
|Status             |PENDING, RUNNING, COMPLETED, SUCCESS, FAIL|
|Message            |message|
|IamUserId          |[User id]|
|AppModuleId        |[Module id]|
|AppId              |[app id]|

`/data/db/AppData.json`
|Key                |Content|
|:------------------|:------|
|Id                 |[id]|
|Name               |[example 'APP_PARAMETER' for parameters or 'NUMBER_SYSTEM' for List of values]|
|Value              |[example 'INFO_LINK_POLICY_NAME', unique value for name]|
|DisplayData        |[example 'Privacy Policy']|
|Data2              |[optional data]|
|Data3              |[optional data]|
|Data4              |[optional data]|
|Data5              |[optional data]|
|AppId              |[app id]|

`/data/db/AppTranslation.json`
|Key                |Content|
|:------------------|:------|
|Id                 |[id]|
|Locale             |[locale]|
|Text               |[text] for simple translation|
|Document           |[json] for advanced translations, see example for app documentation|
|AppId              |[app id]|


## How apps are identified
Apps clients use `common.COMMON_GLOBAL.app_id` to identify themselves
Common uses `common.COMMON_GLOBAL.common_app_id` derived from server parameter `APP_COMMON_APP_ID` and is used to identify common resources.
Admin uses `common.COMMON_GLOBAL.admin_app_id` derived from server parameter `APP_ADMIN_APP_ID` and is used to manage common resources for users and admin.